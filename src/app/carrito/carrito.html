<app-navbar></app-navbar>

    <h1 class="estiloLetra text-center text-2xl sm:text-3xl lg:text-4xl m-3 sm:m-5">Carrito</h1>

    <!-- Mensaje si el carrito está vacío -->
    @if (productosEnCarrito.length === 0) {
      <div class="flex items-center p-4 mb-4 text-sm text-blue-800 border border-blue-300 rounded-lg bg-blue-50 mx-2 sm:mx-5" role="alert">
        <svg class="flex-shrink-0 inline w-4 h-4 me-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20">
          <path d="M10 .5a9.5 9.5 0 1 0 9.5 9.5A9.51 9.51 0 0 0 10 .5ZM9.5 4a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3ZM12 15H8a1 1 0 0 1 0-2h1v-3H8a1 1 0 0 1 0-2h2a1 1 0 0 1 1 1v4h1a1 1 0 0 1 0 2Z"/>
        </svg>
        <span class="sr-only">Info</span>
        <div>
          <span class="font-medium">Tu carrito está vacío</span> No hay productos añadidos al carrito. ¡Explora nuestra tienda para encontrar productos increíbles!
        </div>
      </div>
    } @else {

    <div class="grid grid-cols-1 lg:grid-cols-5 gap-2 m-2 sm:m-5">

      <!-- Productos -->
      <div class="bg-gray-50 border border-red-600 border-4 rounded-xl p-2 sm:p-4 lg:col-span-3 lg:row-span-5 order-1 lg:order-none text-red-600">
        <h2 class="estiloLetra text-center text-lg sm:text-xl lg:text-2xl mb-2 sm:mb-4">Productos</h2>

        <!-- Selector -->
        <div class="flex justify-center mb-4">
          <div class="inline-flex rounded-lg border border-red-600 bg-red-50 p-1">
            <button
              (click)="cambiarVista('carta')"
              [class]="vistaActual === 'carta' ? 'bg-red-600 text-white' : 'text-red-600 hover:bg-red-100'"
              class="inline-flex items-center px-3 py-2 text-xs sm:text-sm font-medium rounded-md transition-colors duration-200">
              <svg class="w-3 h-3 sm:w-4 sm:h-4 me-1 sm:me-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"/>
              </svg>
              Cartas
            </button>
            <button
              (click)="cambiarVista('lista')"
              [class]="vistaActual === 'lista' ? 'bg-red-600 text-white' : 'text-red-600 hover:bg-red-100'"
              class="inline-flex items-center px-3 py-2 text-xs sm:text-sm font-medium rounded-md transition-colors duration-200">
              <svg class="w-3 h-3 sm:w-4 sm:h-4 me-1 sm:me-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 10h16M4 14h16M4 18h16"/>
              </svg>
              Lista
            </button>
          </div>
        </div>

        <!-- Vista de cartas -->
        @if (vistaActual === 'carta') {
          <div class="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-3 gap-3 sm:gap-6 overflow-y-auto max-h-[300px] sm:max-h-[400px] lg:max-h-[500px] p-1 sm:p-2">
            @for (producto of productosEnCarrito; track producto.id) {
              <div class="bg-red-50 block p-3 sm:p-6 border border-default rounded-xl border-red-600 rounded-base shadow-xs text-red-600">
                <img class="rounded-base w-full object-cover h-32 sm:h-40 lg:h-48" src="{{producto.foto}}" alt="{{producto.nombre}}" />

                <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center mt-2 sm:mt-4">
                  <h5 class="text-lg sm:text-xl lg:text-2xl font-semibold tracking-tight text-heading mb-2 sm:mb-0">
                    {{producto.nombre}}
                  </h5>
                  <button type="button" (click)="anyadirProducto(producto.id!)" class="inline-flex items-center text-red-600 bg-brand hover:bg-brand-strong border border-transparent focus:ring-4 focus:ring-brand-medium shadow-xs font-medium rounded-base text-xs sm:text-sm px-2 sm:px-4 py-1.5 sm:py-2.5 focus:outline-none self-start sm:self-auto">
                    <svg class="w-3 h-3 sm:w-4 sm:h-4 me-1 sm:me-1.5 -ms-0.5" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24">
                      <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 4h1.5L9 16m0 0h8m-8 0a2 2 0 1 0 0 4 2 2 0 0 0 0-4Zm8 0a2 2 0 1 0 0 4 2 2 0 0 0 0-4Zm-8.5-3h9.25L19 7H7.312"/>
                    </svg>
                    +
                  </button>
                </div>

                <div class="grid grid-cols-1 sm:grid-cols-2 gap-2 sm:gap-4 mb-3 sm:mb-6 text-xs sm:text-sm text-body">
                  <span>Precio: {{producto.precio}} €</span>
                  <span>Cantidad: {{obtenerCantidadProducto(producto.id!)}}</span>
                </div>

                <p class="mb-3 sm:mb-6 text-xs sm:text-sm text-body line-clamp-2 sm:line-clamp-none">{{producto.descripcion}}</p>

                <div class="flex flex-col sm:flex-row gap-2 sm:justify-between sm:items-center">
                  <a href="" class="inline-flex items-center text-body bg-neutral-secondary-medium border border-red-600 hover:bg-neutral-tertiary-medium hover:text-heading focus:ring-4 focus:ring-neutral-tertiary shadow-xs font-medium rounded-base text-xs sm:text-sm px-2 sm:px-4 py-1.5 sm:py-2.5 focus:outline-none">
                    Ir al producto
                    <svg class="w-3 h-3 sm:w-4 sm:h-4 ms-1 sm:ms-1.5 rtl:rotate-180 -me-0.5" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 12H5m14 0-4 4m4-4-4-4"/></svg>
                  </a>
                  <button (click)="confirmarQuitarItem(producto.id!)" class="inline-flex items-center text-body bg-neutral-secondary-medium border border-red-600 hover:bg-neutral-tertiary-medium hover:text-heading focus:ring-4 focus:ring-neutral-tertiary shadow-xs font-medium rounded-base text-xs sm:text-sm px-2 sm:px-4 py-1.5 sm:py-2.5 focus:outline-none">
                    Quitar producto
                  </button>
                </div>
              </div>
            }
          </div>
        }

        <!-- Vista de lista -->
        @if (vistaActual === 'lista') {
          <div class="space-y-3 overflow-y-auto max-h-[300px] sm:max-h-[400px] lg:max-h-[500px] p-1 sm:p-2">
            @for (producto of productosEnCarrito; track producto.id) {
              <div class="bg-red-50 flex items-center gap-3 sm:gap-4 p-3 sm:p-4 border border-red-600 rounded-xl shadow-xs text-red-600">
                <img class="w-12 h-12 sm:w-16 sm:h-16 lg:w-20 lg:h-20 rounded object-cover flex-shrink-0" src="{{producto.foto}}" alt="{{producto.nombre}}" />

                <div class="flex-1 min-w-0">
                  <h5 class="text-sm sm:text-lg font-semibold text-heading truncate mb-1">{{producto.nombre}}</h5>
                  <p class="text-xs sm:text-sm text-body line-clamp-2 mb-2">{{producto.descripcion}}</p>
                  <div class="flex flex-wrap gap-2 sm:gap-4 text-xs text-body">
                    <span>Precio: {{producto.precio}} €</span>
                    <span>Cantidad: {{obtenerCantidadProducto(producto.id!)}}</span>
                    <span class="font-medium">Total: {{obtenerPrecioTotalPorCantidadProducto(producto.id!)}} €</span>
                  </div>
                </div>

                <div class="flex flex-col gap-2 flex-shrink-0">
                  <button type="button" (click)="anyadirProducto(producto.id!)" class="inline-flex items-center text-red-600 bg-white hover:bg-red-50 border border-red-600 focus:ring-4 focus:ring-red-200 font-medium rounded text-xs px-2 sm:px-3 py-1.5 sm:py-2">
                    <svg class="w-3 h-3 me-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 4h1.5L9 16m0 0h8m-8 0a2 2 0 1 0 0 4 2 2 0 0 0 0-4Zm8 0a2 2 0 1 0 0 4 2 2 0 0 0 0-4Zm-8.5-3h9.25L19 7H7.312"/>
                    </svg>
                    +
                  </button>
                  <button (click)="confirmarQuitarItem(producto.id!)" class="inline-flex items-center text-red-600 bg-white hover:bg-red-50 border border-red-600 focus:ring-4 focus:ring-red-200 font-medium rounded text-xs px-2 sm:px-3 py-1.5 sm:py-2">
                    Quitar
                  </button>
                </div>
              </div>
            }
          </div>
        }
      </div>

      <!-- Resumen del pedido -->
      <div class="bg-gray-50 border border-blue-400 border-4 rounded-xl p-3 sm:p-4 text-white mt-4 lg:mt-0 lg:col-start-4 lg:col-span-2 lg:row-start-1 lg:row-span-3 order-2 lg:order-none">
        <h2 class="text-lg sm:text-xl lg:text-2xl text-center estiloLetra mb-3 sm:mb-4 text-blue-400">Resumen del pedido</h2>
        <div class="flex flex-col gap-2 sm:gap-4 max-h-48 sm:max-h-56 lg:max-h-64 overflow-y-auto">
          @for (producto of productosEnCarrito; track producto.id) {
            <div class="flex justify-between items-center border border-blue-400 text-blue-400 p-2 sm:p-3 bg-blue-50 rounded-xl">
              <span class="font-semibold text-xs sm:text-sm">{{producto.nombre}} x{{obtenerCantidadProducto(producto.id!)}}</span>
              <span class="font-semibold text-xs sm:text-sm">{{(obtenerPrecioTotalPorCantidadProducto(producto.id!))}}€</span>
            </div>
          }
        </div>
      </div>

      <!-- Total -->
      <div class="bg-gray-50 rounded-xl p-3 border border-4 border-yellow-400 sm:p-4 text-black mt-4 lg:mt-0 lg:col-start-4 lg:col-span-2 lg:row-start-4 lg:row-span-2 order-3 lg:order-none">
        <p class="text-lg sm:text-xl lg:text-2xl text-center text-yellow-400 estiloLetra">Total</p>
        <div class="flex gap-2 sm:gap-4 mt-2 sm:mt-4">
          <div class="flex justify-center items-center mt-2 sm:mt-4 bg-yellow-50 p-4 sm:p-8 rounded-xl border border-yellow-400 w-full">
            <p class="text-xl sm:text-xl lg:text-xl text-center text-yellow-400 font-bold">{{calcularTotal()}} €</p>
          </div>

          <button class="flex justify-center items-center mt-2 sm:mt-4 bg-yellow-50 p-4 sm:p-8 rounded-xl border border-yellow-400 w-full" (click)="confirmarCompra()">
            <p class="text-xl sm:text-xl lg:text-xl text-center text-yellow-400 font-bold">Pagar</p>
          </button>
        </div>
      </div>

    </div>

    }

    <!-- Modal de Pago Completo -->
    @if (mostrarModalPago) {
      <div class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-4xl max-h-[90vh] overflow-y-auto">
          <!-- Header con progreso -->
          <div class="border-b border-gray-200 p-4">
            <div class="flex justify-between items-center mb-4">
              <h3 class="text-xl font-semibold text-gray-900">Finalizar Compra</h3>
              <button (click)="cerrarModalPago()" class="text-gray-400 hover:text-gray-600">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                </svg>
              </button>
            </div>

            <!-- Indicador de progreso -->
            <div class="flex items-center justify-center space-x-4">
              <div class="flex items-center">
                <div [class]="pasoActual >= 1 ? 'bg-blue-600 text-white' : 'bg-gray-200 text-gray-600'"
                     class="w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium">1</div>
                <span class="ml-2 text-sm font-medium text-gray-900">Datos</span>
              </div>
              <div class="w-16 h-1 bg-gray-200">
                <div [class]="pasoActual >= 2 ? 'bg-blue-600' : 'bg-gray-200'" class="h-full rounded transition-colors"></div>
              </div>
              <div class="flex items-center">
                <div [class]="pasoActual >= 2 ? 'bg-blue-600 text-white' : 'bg-gray-200 text-gray-600'"
                     class="w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium">2</div>
                <span class="ml-2 text-sm font-medium text-gray-900">Pago</span>
              </div>
              <div class="w-16 h-1 bg-gray-200">
                <div [class]="pasoActual >= 3 ? 'bg-blue-600' : 'bg-gray-200'" class="h-full rounded transition-colors"></div>
              </div>
              <div class="flex items-center">
                <div [class]="pasoActual >= 3 ? 'bg-blue-600 text-white' : 'bg-gray-200 text-gray-600'"
                     class="w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium">3</div>
                <span class="ml-2 text-sm font-medium text-gray-900">Confirmación</span>
              </div>
            </div>
          </div>

          <!-- Body -->
          <div class="p-6">
            <!-- Paso 1: Datos -->
            @if (pasoActual === 1) {
              <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- Datos -->
                <div>
                  <h4 class="text-lg font-medium text-gray-900 mb-4">Datos de facturación</h4>
                  <div class="space-y-4">
                    <div class="grid grid-cols-2 gap-4">
                      <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Nombre</label>
                        <input [(ngModel)]="datosFacturacion.nombre" type="text"
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                               placeholder="Tu nombre">
                      </div>
                      <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Apellidos</label>
                        <input [(ngModel)]="datosFacturacion.apellidos" type="text"
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                               placeholder="Tus apellidos">
                      </div>
                    </div>

                    <div>
                      <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                      <input [(ngModel)]="datosFacturacion.email" type="email"
                             class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                             placeholder="tu@email.com">
                    </div>

                    <div>
                      <label class="block text-sm font-medium text-gray-700 mb-2">Teléfono</label>
                      <input [(ngModel)]="datosFacturacion.telefono" type="tel"
                             class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                             placeholder="+34 123 456 789">
                    </div>

                    <div>
                      <label class="block text-sm font-medium text-gray-700 mb-2">Dirección</label>
                      <input [(ngModel)]="datosFacturacion.direccion" type="text"
                             class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                             placeholder="Calle, número, piso">
                    </div>

                    <div class="grid grid-cols-2 gap-4">
                      <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Ciudad</label>
                        <input [(ngModel)]="datosFacturacion.ciudad" type="text"
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                               placeholder="Tu ciudad">
                      </div>
                      <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Código Postal</label>
                        <input [(ngModel)]="datosFacturacion.codigoPostal" type="text"
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                               placeholder="28001">
                      </div>
                    </div>

                    <div>
                      <label class="block text-sm font-medium text-gray-700 mb-2">País</label>
                      <select [(ngModel)]="datosFacturacion.pais"
                              class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <option value="España">España</option>
                        <option value="Francia">Francia</option>
                        <option value="Italia">Italia</option>
                        <option value="Portugal">Portugal</option>
                        <option value="Reino Unido">Reino Unido</option>
                      </select>
                    </div>
                  </div>
                </div>

                <!-- Resumen del pedido -->
                <div>
                  <h4 class="text-lg font-medium text-gray-900 mb-4">Resumen del pedido</h4>
                  <div class="bg-gray-50 rounded-lg p-4">
                    <div class="space-y-3 mb-4">
                      @for (producto of productosEnCarrito; track producto.id) {
                        <div class="flex justify-between items-center text-sm">
                          <span class="flex-1">{{producto.nombre}} x{{obtenerCantidadProducto(producto.id!)}}</span>
                          <span class="font-medium">{{obtenerPrecioTotalPorCantidadProducto(producto.id!)}} €</span>
                        </div>
                      }
                    </div>
                    <div class="border-t pt-3 flex justify-between items-center font-semibold text-lg">
                      <span>Total:</span>
                      <span class="text-blue-600">{{calcularTotal()}} €</span>
                    </div>
                  </div>
                </div>
              </div>
            }

            <!-- Paso 2: Mejodo de pago -->
            @if (pasoActual === 2) {
              <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div>
                  <h4 class="text-lg font-medium text-gray-900 mb-4">Método de pago</h4>

                  <!-- Tarjeta -->
                  <div class="border border-gray-200 rounded-lg p-4 mb-4">
                    <div class="flex items-center mb-4">
                      <input type="radio" id="tarjeta" name="metodoPago" value="tarjeta" checked
                             class="w-4 h-4 text-blue-600 focus:ring-blue-500">
                      <label for="tarjeta" class="ml-2 text-sm font-medium text-gray-900">Tarjeta de crédito/débito</label>
                    </div>

                    <div class="space-y-4">
                      <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Número de tarjeta</label>
                        <input [(ngModel)]="datosTarjeta.numero" type="text" maxlength="19"
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                               placeholder="1234 5678 9012 3456">
                      </div>

                      <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Titular de la tarjeta</label>
                        <input [(ngModel)]="datosTarjeta.titular" type="text"
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                               placeholder="NOMBRE APELLIDOS">
                      </div>

                      <div class="grid grid-cols-2 gap-4">
                        <div>
                          <label class="block text-sm font-medium text-gray-700 mb-2">Fecha de expiración</label>
                          <input [(ngModel)]="datosTarjeta.expiracion" type="text" maxlength="5"
                                 class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                 placeholder="MM/AA">
                        </div>
                        <div>
                          <label class="block text-sm font-medium text-gray-700 mb-2">CVV</label>
                          <input [(ngModel)]="datosTarjeta.cvv" type="text" maxlength="3"
                                 class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                 placeholder="123">
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- Otros metodos -->
                  <div class="space-y-3">
                    <button (click)="procesarPago('PayPal')"
                            class="w-full p-4 border-2 border-gray-200 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition-colors flex items-center gap-3">
                      <svg class="w-8 h-8 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"/>
                      </svg>
                      <div class="text-left">
                        <div class="font-medium">PayPal</div>
                        <div class="text-sm text-gray-500">Pago seguro con PayPal</div>
                      </div>
                    </button>

                    <button (click)="procesarPago('Transferencia Bancaria')"
                            class="w-full p-4 border-2 border-gray-200 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition-colors flex items-center gap-3">
                      <svg class="w-8 h-8 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/>
                      </svg>
                      <div class="text-left">
                        <div class="font-medium">Transferencia Bancaria</div>
                        <div class="text-sm text-gray-500">Pago mediante transferencia</div>
                      </div>
                    </button>
                  </div>
                </div>

                <!-- Resumen -->
                <div>
                  <h4 class="text-lg font-medium text-gray-900 mb-4">Datos de envío</h4>
                  <div class="bg-gray-50 rounded-lg p-4">
                    <div class="text-sm space-y-1">
                      <p class="font-medium">{{datosFacturacion.nombre}} {{datosFacturacion.apellidos}}</p>
                      <p>{{datosFacturacion.email}}</p>
                      <p>{{datosFacturacion.telefono}}</p>
                      <p>{{datosFacturacion.direccion}}</p>
                      <p>{{datosFacturacion.codigoPostal}} {{datosFacturacion.ciudad}}</p>
                      <p>{{datosFacturacion.pais}}</p>
                    </div>
                    <button (click)="pasoAnterior()" class="mt-3 text-blue-600 text-sm hover:underline">
                      Editar datos
                    </button>
                  </div>
                </div>
              </div>
            }

            <!-- Procesando -->
            @if (pasoActual === 3 && pagoEnProceso) {
              <div class="text-center py-8">
                <div class="inline-block animate-spin rounded-full h-16 w-16 border-b-2 border-blue-600 mb-4"></div>
                <h4 class="text-lg font-medium text-gray-900 mb-2">Procesando pago...</h4>
                <p class="text-gray-500">Por favor espere mientras procesamos su pago de forma segura</p>
              </div>
            }
          </div>

          <!-- botones -->
          @if (pasoActual !== 3) {
            <div class="border-t border-gray-200 px-6 py-4 flex justify-between">
              <button (click)="cerrarModalPago()"
                      class="px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50">
                Cancelar
              </button>
              <div class="space-x-3">
                @if (pasoActual === 2) {
                  <button (click)="pasoAnterior()"
                          class="px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50">
                    Anterior
                  </button>
                }
                @if (pasoActual === 1) {
                  <button (click)="siguientePaso()"
                          class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                    Continuar
                  </button>
                }
                @if (pasoActual === 2) {
                  <button (click)="procesarPago('Tarjeta de Crédito')"
                          class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                    Pagar {{calcularTotal()}} €
                  </button>
                }
              </div>
            </div>
          }
        </div>
      </div>
    }

    <app-footer></app-footer>
